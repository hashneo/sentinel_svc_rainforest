"use strict";

const q = require('q');
const http = require('superagent');

module.exports = getInstance;

function getInstance(url) {
    let instance = {};
    instance.url = url;
    instance.verify = verify;
    return instance;
}


function verify(jwt) {
    let defer = q.defer();
    http
        .get(`${this.url}?jwt=${jwt}`)
        .set('Accept','application/json')
        .end(function(err, res) {
           if (err) {
               if (res)
                defer.reject(res.body);
               else
                defer.reject('error in communication with JWT verification service');
           } else {
               defer.resolve(res.body);
           }
        });

    return defer.promise;
}